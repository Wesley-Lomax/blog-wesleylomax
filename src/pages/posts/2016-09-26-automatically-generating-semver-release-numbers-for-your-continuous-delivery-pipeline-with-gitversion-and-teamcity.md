---
title: Automatically generating SemVer release numbers for your Continuous Delivery Pipeline with GitVersion and TeamCity
author: Wesley Lomax
type: post
date: 2016-09-26T12:58:35.000Z
url: /2016/09/26/automatically-generating-semver-release-numbers-for-your-continuous-delivery-pipeline-with-gitversion-and-teamcity/
categories:
  - Continuous Delivery
tags:
  - Continuous Delivery
  - GitFlow
  - GitVersion
  - Octopus Deploy
  - TeamCity
templateKey: blog-post
---
<div id="toc_container" class="toc_wrap_right no_bullets">
  <p class="toc_title">
    Contents
  </p>
  
  <ul class="toc_list">
    <li>
      <a href="#Setup"><span class="toc_number toc_depth_1">1</span> Setup</a><ul>
        <li>
          <ul>
            <li>
              <a href="#GitVersion_Build_Server_Support"><span class="toc_number toc_depth_3">1.0.1</span> GitVersion Build Server Support</a>
            </li>
          </ul>
        </li>
      </ul>
    </li>
    
    <li>
      <a href="#Setup_for_TeamCity"><span class="toc_number toc_depth_1">2</span> Setup for TeamCity</a>
    </li>
    <li>
      <a href="#Results"><span class="toc_number toc_depth_1">3</span> Results</a>
    </li>
  </ul>
</div>

Following on from my posts <a href="https://blog.wesleylomax.co.uk/2016/04/06/continuous-delivery-sitecore-tds-git-team-city-octopus-sitecore-ship-part-1" target="_blank">Continuous Delivery with Sitecore Part 1 – TeamCity Setup</a> and <a href="http://blog.wesleylomax.co.uk/2016/04/19/continuous-delivery-sitecore-tds-git-team-city-octopus-sitecore-ship-part-2/" target="_blank">Continuous Delivery with Sitecore Part 2 – Octopus Deploy Setup</a>, I&#8217;ve added another step to achieve _Semantic Versioning (SemVer)_ in my deployment pipeline, as we are already using <a href="http://nvie.com/posts/a-successful-git-branching-model/" target="_blank">GitFlow </a> for branching we only had some configuration changes to make.

I&#8217;ve added <a href="https://github.com/GitTools/GitVersion" target="_blank">GitVersion</a> to our release process, they claim

> Versioning when using git, solved. GitVersion looks at your git history and works out the semantic version ([semver.org][1]) of the commit being built.

This enables my release numbers to be automatically generated using <a href="http://semver.org/" target="_blank">semver.org</a> and this number can be used to version assemblies,  add source control tags and for any NuGet packages or other artifacts your build process generates.

## <span id="Setup">Setup</span>

  * Add a reference to [GitVersionTask via Nuget][2] to your solution <pre class="brush: plain; title: ; notranslate" title="">Install-Package GitVersionTask -Version 3.6.3

</pre>

  * You will need to generate a GitVersionConfig.yaml config file and add it to the root of your solution mine is below, GitVersion will then use this configuration and your repository history to work out the next build number, for more on the configuration file see the documentation &#8211;<a href="https://gitversion.readthedocs.io/en/latest/configuration/" target="_blank"> https://gitversion.readthedocs.io/en/latest/configuration/</a>

<div class="oembed-gist">
  <noscript>
    View the code on <a href="https://gist.github.com/Wesley-Lomax/9b5d587604cf8f2ebf1c5144da2f4342">Gist</a>.
  </noscript>
</div>

I use Team City and Octopus Deploy for build and deployment currently but GitVersion Supports a wide range of build tools.

#### <span id="GitVersion_Build_Server_Support">GitVersion Build Server Support</span> {#build-server-support}

GitVersion has support for quite a few build servers out of the box. Currently we support:

  * [AppVeyor][3]
  * [Bamboo][4]
  * [Continua CI][5]
  * [GitLab CI][6]
  * [Jenkins][7]
  * [MyGet][8]
  * [Octopus Deploy][9]
  * [TeamCity][10]
  * [Team Build (TFS)][11]
  * [TFS Build vNext][12]Source &#8211; <https://gitversion.readthedocs.io/en/latest/build-server-support/build-server-support>/

## <span id="Setup_for_TeamCity">Setup for TeamCity</span>

  * Create new System Parameters to act as placeholders for the values generated by GitVersion, I have created **system.GitVersion.FullSemVer, system.GitVersion.NuGetVersion** and **system.GitVersion.SemVer.** You can view the Variables generated by GitVersion here &#8211; <https://gitversion.readthedocs.io/en/latest/more-info/variables/>

<a href="https://i0.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/TeamCityParameters.png" target="\_blank" data-rel="lightbox-image-0" data-rl\_title="" data-rl_caption="" title=""><img class="alignnone wp-image-466 size-full" src="https://i0.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/TeamCityParameters.png?resize=640%2C116" alt="teamcityparameters" width="640" height="116" srcset="https://i0.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/TeamCityParameters.png?w=1366 1366w, https://i0.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/TeamCityParameters.png?resize=300%2C54 300w, https://i0.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/TeamCityParameters.png?resize=768%2C139 768w, https://i0.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/TeamCityParameters.png?resize=1024%2C185 1024w, https://i0.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/TeamCityParameters.png?w=1280 1280w" sizes="(max-width: 640px) 100vw, 640px" data-recalc-dims="1" /></a>

&nbsp;

Set the Build number format of your Team City Build to ___**%system.GitVersion.SemVer%**  ___the placeholder we previously created.

&nbsp;

&nbsp;

<a href="https://i1.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/BuildNumberFormat.png" target="\_blank" data-rel="lightbox-image-1" data-rl\_title="" data-rl_caption="" title=""><img class="wp-image-461 size-full alignnone" src="https://i1.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/BuildNumberFormat.png?resize=640%2C125" alt="buildnumberformat" width="640" height="125" srcset="https://i1.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/BuildNumberFormat.png?w=1285 1285w, https://i1.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/BuildNumberFormat.png?resize=300%2C58 300w, https://i1.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/BuildNumberFormat.png?resize=768%2C149 768w, https://i1.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/BuildNumberFormat.png?resize=1024%2C199 1024w" sizes="(max-width: 640px) 100vw, 640px" data-recalc-dims="1" /></a>

&nbsp;

&nbsp;

Add a new Command Line step to your build, after your NuGet Packages have been restored and before your Build and OctoPack step. The Command Executable is **GitVersion** and the command parameters are ********. /updateAssemblyInfo /output buildserver********

&nbsp;

&nbsp;

<a href="https://i0.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/TeamCityStep.png" target="\_blank" data-rel="lightbox-image-2" data-rl\_title="" data-rl_caption="" title=""><img class="alignnone wp-image-467 size-full" src="https://i0.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/TeamCityStep.png?resize=640%2C403" alt="teamcitystep" width="640" height="403" srcset="https://i0.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/TeamCityStep.png?w=824 824w, https://i0.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/TeamCityStep.png?resize=300%2C189 300w, https://i0.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/TeamCityStep.png?resize=768%2C484 768w" sizes="(max-width: 640px) 100vw, 640px" data-recalc-dims="1" /></a>

&nbsp;

Add the new system variable in the <label for="octopus_octopack_package_version"><label for="octopus_octopack_package_version">OctoPack package version field &#8211; <strong>%system.GitVersion.NuGetVersion%</strong></label></label>

&nbsp;

&nbsp;

<a href="https://i2.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/OctoPackVersion.png" target="\_blank" data-rel="lightbox-image-3" data-rl\_title="" data-rl_caption="" title=""><img class="alignnone wp-image-474 size-full" src="https://i2.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/OctoPackVersion.png?resize=640%2C161" alt="octopackversion" width="640" height="161" srcset="https://i2.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/OctoPackVersion.png?w=805 805w, https://i2.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/OctoPackVersion.png?resize=300%2C76 300w, https://i2.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/OctoPackVersion.png?resize=768%2C194 768w" sizes="(max-width: 640px) 100vw, 640px" data-recalc-dims="1" /></a>

&nbsp;

<label for="octopus_octopack_package_version">You can read more about the OctoPack plugin for TeamCity here &#8211;<strong> </strong></label><http://docs.octopusdeploy.com/display/OD/TeamCity#TeamCity-InstallPluginInstallingtheplugin>

On your Create Release and Develop Release steps when using the Octopus TeamCity plugin set the Release number field to **********%system.GitVersion.NuGetVersion%**********

&nbsp;

&nbsp;

<a href="https://i0.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/OctopusCreateReleaseBuildsNumber.png" target="\_blank" data-rel="lightbox-image-4" data-rl\_title="" data-rl_caption="" title=""><img class="alignnone wp-image-463 size-full" src="https://i0.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/OctopusCreateReleaseBuildsNumber.png?resize=640%2C92" alt="octopuscreatereleasebuildsnumber" width="640" height="92" srcset="https://i0.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/OctopusCreateReleaseBuildsNumber.png?w=777 777w, https://i0.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/OctopusCreateReleaseBuildsNumber.png?resize=300%2C43 300w, https://i0.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/OctopusCreateReleaseBuildsNumber.png?resize=768%2C111 768w" sizes="(max-width: 640px) 100vw, 640px" data-recalc-dims="1" /></a>

&nbsp;

That is all the setup required, when you next Run a new build on TeamCity you should see the results:-

## <span id="Results">Results</span>

TeamCity builds with SemVer build numbers.

<a href="https://i2.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/TeamCityBuilds.png" target="\_blank" data-rel="lightbox-image-5" data-rl\_title="" data-rl_caption="" title=""><img class="alignnone wp-image-465 size-full" src="https://i2.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/TeamCityBuilds.png?resize=423%2C144" alt="teamcitybuilds" width="423" height="144" srcset="https://i2.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/TeamCityBuilds.png?w=423 423w, https://i2.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/TeamCityBuilds.png?resize=300%2C102 300w" sizes="(max-width: 423px) 100vw, 423px" data-recalc-dims="1" /></a>

TDS packages with NuGetVersion version generated by GitVersion

<a href="https://i1.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/TDSPacakges.png" target="\_blank" data-rel="lightbox-image-6" data-rl\_title="" data-rl_caption="" title=""><img class="alignnone wp-image-464 size-full" src="https://i1.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/TDSPacakges.png?resize=640%2C89" alt="tdspacakges" width="640" height="89" srcset="https://i1.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/TDSPacakges.png?w=1202 1202w, https://i1.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/TDSPacakges.png?resize=300%2C42 300w, https://i1.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/TDSPacakges.png?resize=768%2C107 768w, https://i1.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/TDSPacakges.png?resize=1024%2C142 1024w" sizes="(max-width: 640px) 100vw, 640px" data-recalc-dims="1" /></a>

Octopus Deploy release numbers using NuGetVersion

<a href="https://i1.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/OctopusBuilds.png" target="\_blank" data-rel="lightbox-image-7" data-rl\_title="" data-rl_caption="" title=""><img class="alignnone wp-image-462 size-full" src="https://i1.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/OctopusBuilds.png?resize=640%2C105" alt="octopusbuilds" width="640" height="105" srcset="https://i1.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/OctopusBuilds.png?w=834 834w, https://i1.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/OctopusBuilds.png?resize=300%2C49 300w, https://i1.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/OctopusBuilds.png?resize=768%2C126 768w" sizes="(max-width: 640px) 100vw, 640px" data-recalc-dims="1" /></a>

Assemblies stamped with the same SemVer release number.

<a href="https://i1.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/Assembly.png" target="\_blank" data-rel="lightbox-image-8" data-rl\_title="" data-rl_caption="" title=""><img class="alignnone wp-image-460 size-full" src="https://i1.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/Assembly.png?resize=318%2C239" alt="assembly" width="318" height="239" srcset="https://i1.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/Assembly.png?w=318 318w, https://i1.wp.com/blog.wesleylomax.co.uk/wp-content/uploads/2016/09/Assembly.png?resize=300%2C225 300w" sizes="(max-width: 318px) 100vw, 318px" data-recalc-dims="1" /></a>

###

 [1]: http://semver.org/
 [2]: https://www.nuget.org/packages/GitVersionTask/3.6.3
 [3]: https://gitversion.readthedocs.io/en/latest/build-server-support/build-server/appveyor/
 [4]: https://gitversion.readthedocs.io/en/latest/build-server-support/build-server/bamboo/
 [5]: https://gitversion.readthedocs.io/en/latest/build-server-support/build-server/continua/
 [6]: https://gitversion.readthedocs.io/en/latest/build-server-support/build-server/gitlab/
 [7]: https://gitversion.readthedocs.io/en/latest/build-server-support/build-server/jenkins/
 [8]: https://gitversion.readthedocs.io/en/latest/build-server-support/build-server/myget/
 [9]: https://gitversion.readthedocs.io/en/latest/build-server-support/build-server/octopus-deploy/
 [10]: https://gitversion.readthedocs.io/en/latest/build-server-support/build-server/teamcity/
 [11]: https://gitversion.readthedocs.io/en/latest/build-server-support/build-server/teambuild/
 [12]: https://gitversion.readthedocs.io/en/latest/build-server-support/build-server/tfs-build-vnext/